<!--#set var="title" value="Дай знать | Диалог" -->
<!--#include virtual="/parts/header__dashboard.html" -->

  <main class="dashboard__dialog">
    <div class="container">
      <section class="dialog">

        <div class="dialog__header">
          <div class="header__title">
            <span class="page">диалог:</span>
            <h1 class="name">Devon Lane</h1>
          </div>
          <a href="" class="new-window"></a>
        </div>

        <div class="dialog__inner">

          <div class="messages">
            <div id="msgList"><input type="hidden" id="lastmsg" value="20">
              <ul class="messages__list" id="dvMessages">

                <li class="messages__item--user">
                  <p>Djjdeje bsh<br>
                    <img src="https://dai-znat.com.ua/reviewimg/zno_214854/tconhviu.eit.jpg" height="50">
                  </p>
                  <div class="messages__info">
                    <span class="messages__time">02.10 10:38</span> 
                  </div>
                </li>
                <li class="messages__item--companion">
                  <div class="user-photo">
                    <img src="images/dist/photo.jpg" alt="Фото собеседника">
                  </div>
                  <p>fsdf sdf</p>
                  <div class="messages__info">
                    <span class="messages__time">02.10 17:40</span> 
                  </div>
                </li>
                <li class="messages__item--companion">
                  <div class="user-photo">
                    <img src="images/dist/photo.jpg" alt="Фото собеседника">
                  </div>
                  <p>ыва ываыв а</p>
                  <div class="messages__info">
                    <span class="messages__time">02.10 17:40</span> 
                  </div>
                </li>
                <li class="messages__item--companion">
                  <div class="user-photo">
                    <img src="images/dist/photo.jpg" alt="Фото собеседника">
                  </div>
                  <p>.....</p>
                  <div class="messages__info">
                    <span class="messages__time">02.10 17:46</span> 
                  </div>
                </li>
                <li class="messages__item--user">
                  <p>шо?
                  </p>
                  <div class="messages__info">
                    <span class="messages__time">02.10 17:46</span> 
                  </div>
                </li>
                <li class="messages__item--companion">
                  <div class="user-photo">
                    <img src="images/dist/photo.jpg" alt="Фото собеседника">
                  </div>
                  <p>Капшо</p>
                  <div class="messages__info">
                    <span class="messages__time">02.10 17:46</span> 
                  </div>
                </li>
                <li class="messages__item--user">
                  <p>кушай хорошо</p>
                  <div class="messages__info">
                    <span class="messages__time">02.10 17:46</span> 
                  </div>
                </li>
                <li class="messages__item--user">
                  <p>кушай 22</p>
                  <div class="messages__info">
                    <span class="messages__time">02.10 17:46</span> 
                  </div>
                </li>
                <li class="messages__item--companion">
                  <div class="user-photo">
                    <img src="images/dist/photo.jpg" alt="Фото собеседника">
                  </div>
                  <p>аывавыаыва</p>
                  <div class="messages__info">
                    <span class="messages__time">04.10 11:46</span> 
                  </div>
                </li>
                <li class="messages__item--companion">
                  <div class="user-photo">
                    <img src="images/dist/photo.jpg" alt="Фото собеседника">
                  </div>
                  <p>укн укцнукнцукнуцк нукцн уцкн</p>
                  <div class="messages__info">
                    <span class="messages__time">04.10 11:46</span> 
                  </div>
                </li>
                <li class="messages__item--companion">
                  <div class="user-photo">
                    <img src="images/dist/photo.jpg" alt="Фото собеседника">
                  </div>
                  <p>дай знать!

                    /
                    Заказать звонок
                    RU
                    Чат с владельцем - «ЗНО курсы»
                    Djjdeje bsh


                    02.10 10:38
                    fsdf sdf

                    02.10 17:40
                    ыва ываыв а

                    02.10 17:40
                    .....

                    02.10 17:46
                    шо?

                    02.10 17:46
                    Капшо

                    02.10 17:46
                    кушай хорошо

                    02.10 17:46
                    кушай 22

                    02.10 17:46
                    аывавыаыва

                    04.10 11:46
                    укн укцнукнцукнуцк нукцн уцкн

                    04.10 11:46
                    Фото пользователя
                    Сообщение


                    © 2021
                    ДайЗнатьдай знать!

                    /
                    Заказать звонок
                    RU
                    Чат с владельцем - «ЗНО курсы»
                    Djjdeje bsh


                    02.10 10:38
                    fsdf sdf

                    02.10 17:40
                    ыва ываыв а

                    02.10 17:40
                    .....

                    02.10 17:46
                    шо?

                    02.10 17:46
                    Капшо

                    02.10 17:46
                    кушай </p>
                  <div class="messages__info">
                    <span class="messages__time">04.10 11:46</span> 
                  </div>
                </li>
                <li class="messages__item--companion">
                  <div class="user-photo">
                    <img src="images/dist/photo.jpg" alt="Фото собеседника">
                  </div>
                  <p>пе авпвыацп укпукп укпу кпукпукн уцкн ук</p>
                  <div class="messages__info">
                    <span class="messages__time">04.10 11:46</span> 
                  </div>
                </li>
                <li class="messages__item--companion">
                  <div class="user-photo">
                    <img src="images/dist/photo.jpg" alt="Фото собеседника">
                  </div>
                  <p>н43н34 н34н 3н</p>
                  <div class="messages__info">
                    <span class="messages__time">04.10 11:46</span> 
                  </div>
                </li>
                <li class="messages__item--companion">
                  <div class="user-photo">
                    <img src="images/dist/photo.jpg" alt="Фото собеседника">
                  </div>
                  <p>43н3 4н34н34н</p>
                  <div class="messages__info">
                    <span class="messages__time">04.10 11:46</span> 
                  </div>
                </li>
                <li class="messages__item--user"> 
                  <img src="https://dai-znat.com.ua/reviewimg//155dybxc.4dx.webp"
                    alt="Изображение">
                  <div class="messages__info">
                    <span class="messages__time">04.10 15:23</span> 
                  </div>
                </li>
              </ul>
            </div>

            <form class="write-box" action="" method="POST">
              <div class="user-photo">
                <img src="images/dist/photo.jpg" alt="Фото пользователя">
              </div>
              <div class="wrap-textarea">
                <textarea name="" id="" placeholder="Сообщение" cols="300" rows="2" required></textarea>
                <div class="btns">
                  <input id="fileinput" accept="image/*" type="file" name="fileinput" style="display: none">
                  <button class="btn--upload-img"></button>
                  <!--<button class="btn--smiles"></button>-->
                </div>
              </div>
              <div class="write-box__btns">
                <button class="fa fa-check done"></button>
                <button class="fa fa-close failed"></button>

                <button class="btn--send submit" type="submit" id="btnSendMsg"></button>
                <button class="btn--delete"></button>
                <button class="btn--close"><span class="line"></span></button>
              </div>
              <input name="__RequestVerificationToken" type="hidden" value="CfDJ8HnNvKFVBqpNrvbQdJWXo0i6mrr8MXL-rkc2fYFfvLdvG_JfdOV1MsMuPUXSAS2pClwsBOKWU2raUk6n7TzRpkObuBIwaxvhj4im0uNAGsc4MwkmKkcOy6HkXh2fIE7rteTezOcWODDTZCfoT9Wb1d8">
            </form>
          </div>

          <div class="feedback">

            <div class="feedback__header">
              <div class="feedback__info">
                <time class="time" datetime="2021-12-12 23:00">23:00 12.12.2021</time>
                <h2 class="name">Devon Lane</h2>
                <div class="organization">Фламінго</div>
              </div>
            </div>

            <div class="status">
              <div class="status__list__item btn--dropdown" rel="dropdown">
                <h3 class="title">статус обращения</h3>
                <div class="status__select">
                  <span>В работе 🚀</span>
                </div>
              </div>
              <div class="status__dropdown dropdown">
                <ul class="status__list">
                  <li class="status__list__item">
                    <span>В работе 🚀</span>
                  </li>
                  <li class="status__list__item red">
                    <span>Новое 🔥</span>
                  </li>
                </ul>
              </div>
            </div>

            <div class="tags">
              <div class="tags__list__item btn--dropdown" rel="dropdown">
                <div class="tags__select">
                  <span class="tags__color yellow"></span>
                  <span class="tags__title">призначення</span>
                  <span class="tags__name">Обслуговування</span>
                </div>
              </div>

              <div class="tags__dropdown dropdown">
                <ul class="tags__list">
                  <li class="tags__list__item">
                    <label class="">
                      <input type="checkbox" id="">
                      <span class="chbx"></span>
                      <span class="tags__color"></span>
                      <span class="tags__title">призначення</span>
                      <span class="tags__name">Чистота</span>
                    </label>
                    <div class="btns">
                      <button class="btn--edit"></button>
                      <button class="btn--delite"></button>
                    </div>
                  </li>
                  <li class="tags__list__item">
                    <label class="">
                      <input type="checkbox" id="">
                      <span class="chbx"></span>
                      <span class="tags__color yellow"></span>
                      <span class="tags__title">призначення</span>
                      <span class="tags__name">Меню</span>
                    </label>
                    <div class="btns">
                      <button class="btn--edit"></button>
                      <button class="btn--delite"></button>
                    </div>
                  </li>
                  <li class="tags__list__item">
                    <label class="">
                      <input type="checkbox" id="">
                      <span class="chbx"></span>
                      <span class="tags__color blue"></span>
                      <span class="tags__title">призначення</span>
                      <span class="tags__name">Літня тераса</span>
                    </label>
                    <div class="btns">
                      <button class="btn--edit"></button>
                      <button class="btn--delite"></button>
                    </div>
                  </li>
                  <li class="tags__list__item">
                    <label class="">
                      <input type="checkbox" id="">
                      <span class="chbx"></span>
                      <span class="tags__color red"></span>
                      <span class="tags__title">призначення</span>
                      <div class="tags__name">Обслуговування</div>
                    </label>
                    <div class="btns">
                      <button class="btn--edit"></button>
                      <button class="btn--delite"></button>
                    </div>
                  </li>
                </ul>
              </div>
            </div>

            <div class="comments">
              <ul class="comments__list">
                <li class="comments__list__item">
                  <div class="comments__header">
                    <time class="comments__data" datetime="">11:50 12.12.2021</time>
                    <span class="comments__name">Манеджер Тарас</span>
                  </div>
                  <p class="comments__text">Капризный клиент. Даже очень!</p>
                  <button class="btn--delete"></button>
                </li>
                <li class="comments__list__item">
                  <div class="comments__header">
                    <time class="comments__data" datetime="">11:50 12.12.2021</time>
                    <span class="comments__name">Манеджер Тарас</span>
                  </div>
                  <p class="comments__text">Капризный клиент. Даже очень!</p>
                  <button class="btn--delete"></button>
                </li>
                <li class="comments__list__item">
                  <div class="comments__header">
                    <time class="comments__data" datetime="">11:50 12.12.2021</time>
                    <span class="comments__name">Манеджер Тарас</span>
                  </div>
                  <p class="comments__text">Капризный клиент. Даже очень!</p>
                  <button class="btn--delete"></button>
                </li>
              </ul>

              <button class="btn--transparrent btn--dropdown" rel="dropdown">добавить коментарий <span>+</span></button>

              <div class="feedback__comment dropdown">
                <form class="write-box" action="" method="POST">
                  <textarea name="" id="" placeholder="Сообщение" cols="300" rows="2" required></textarea>
                  <button class="btn--send" type="submit"></button>
                </form>
              </div>
            </div>

          </div>

        </div>

      </section>
      <!-- /.dialog -->
    </div>
  </main>

  <script type="text/javascript">


    $("#btnSendMsg").click(function(e) {
        e.preventDefault();
        $(".btn--send").addClass("loading");

        var data = new FormData();
        data.append('uid', '3Q3k0abv');
        data.append('msg', $('#txtMsg').val());
        $(".submit").addClass("loading");
      $.ajax({
            type: 'POST',
            processData: false, 
            contentType: false,
            data: data,
            url: '/chat/SendMsg',
            dataType: 'json',
          
            success: function (jsonData) {
                data.append('msg', $('#txtMsg').val(''));
                LoadMsg();

                $(".submit").removeClass("loading");
                $(".submit").removeClass("hide-loading");
                $(".done").removeClass("finish");
                $(".failed").removeClass("finish");
            }
        });

    });

    /*$("#dvMessages").on( 'scroll', function(e){
        console.log('Event Fired');
        console.log(e);
    });*/


    function LoadMsg() {
        $.get('/chat/LoadMsg/3Q3k0abv/',
            function(data) {
                $("#msgList").html(data);
            }).done(function () {
            $("#dvMessages").scrollTop($("#dvMessages")[0].scrollHeight);
                setTimeout(function () { CheckMsg(); },3000);
        });
    }

    function CheckMsg() {
        $.get('/chat/CheckMsg/3Q3k0abv/'+$("#lastmsg").val(),
            function(data) {
                if (data) {
                    LoadMsg();
                }else{
                    setTimeout(function () { CheckMsg(); }, 3000);
                }
            }).done(function () {
        });
    }

    $(document).ready(function() {
        $("input:radio[value='ok']").attr('checked', true);
        $("#dvMessages").scrollTop($("#dvMessages")[0].scrollHeight);
        $("#txtMsg").focus();
        CheckMsg();
    });

    $(".btn--upload-img").on('click',
        function (e) {
            e.preventDefault();
            $('#fileinput').trigger('click');
        });

    $("#fileinput").change(function(e) {
        var data = new FormData();
        data.append('uid','3Q3k0abv');
        data.append('up_file', $('#fileinput').prop('files')[0]);
      
        $.ajax({
            type: 'POST',
            processData: false, 
            contentType: false,
            data: data,
            url: '/chat/UpdloadImg',
            dataType : 'json',
            success: function(jsonData) {
                LoadMsg();
            }
        });
    });

  </script>

<!--#include virtual="/parts/footer__dashboard.html" -->